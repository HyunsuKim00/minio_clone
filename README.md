🎯 현재 시스템의 문제점
1. 비효율적인 다운로드
파일 5개를 선택하면 → presigned URL 5번 생성 → 개별 다운로드 5번
사용자는 5개의 파일을 각각 저장해야 함
네트워크 요청이 너무 많음
2. 폴더 구조 부재
모든 파일이 평면적으로 나열됨
S3의 folder1/subfolder/file.txt 같은 구조를 제대로 활용하지 못함
폴더 단위 작업 불가능
🔄 개선된 시스템 동작 방식
1단계: 복수 파일 다운로드 개선
현재 방식:
사용자가 파일 5개 선택
브라우저가 presigned URL API를 5번 호출
각 파일을 개별적으로 다운로드
사용자는 5개 파일을 각각 저장
개선된 방식:
사용자가 파일 5개 선택
브라우저가 "다운로드 API"에 선택된 파일 목록 전송 (1번 호출)
서버에서 S3로부터 5개 파일을 가져와서 ZIP으로 압축
사용자는 1개의 ZIP 파일만 다운로드
장점:
네트워크 요청: 10번 → 1번
사용자 경험: 5번 저장 → 1번 저장
파일 관리: 개별 파일들 → 하나의 압축파일
2단계: 폴더 구조 표시 개선
현재:
folder1/file1.txt, folder1/file2.txt, folder2/file3.txt가 모두 평면적으로 나열
개선 후:
📁 folder1/ (2개 파일)
📁 folder2/ (1개 파일)
📄 root-file.txt
동작 방식:
S3 listObjectsV2에 Delimiter: '/' 추가
응답에서 CommonPrefixes는 폴더로, Contents는 파일로 분류
폴더 클릭 시 해당 prefix로 필터링하여 하위 내용 표시
3단계: 폴더 기능 구현
A. 폴더 생성
사용자가 "폴더 생성" 버튼 클릭
폴더명 입력 (예: "새폴더")
서버에서 새폴더/.placeholder 빈 파일 생성
목록 새로고침하여 폴더 표시
B. 폴더 업로드
사용자가 "폴더 업로드" 버튼 클릭
브라우저의 폴더 선택 다이얼로그 열림 (webkitdirectory 속성)
선택된 모든 파일의 상대 경로 유지하여 개별 업로드
예: 내폴더/파일1.txt, 내폴더/서브폴더/파일2.txt 구조 그대로 S3에 저장
C. 폴더 다운로드
사용자가 폴더 클릭 후 다운로드
서버에서 해당 prefix의 모든 파일 조회
모든 파일을 ZIP으로 압축 (폴더 구조 유지)
사용자는 폴더명.zip 다운로드
4단계: 네비게이션 개선
Breadcrumb 네비게이션:
홈 > 버킷명 > folder1 > subfolder
각 단계 클릭 시 해당 레벨로 이동
URL 구조:
/browser/bucket-name/ → 루트
/browser/bucket-name/folder1/ → folder1 내부
/browser/bucket-name/folder1/subfolder/ → 중첩 폴더
🔧 핵심 기술적 접근법
가상 폴더 방식
S3는 실제 폴더가 없고 모든 것이 파일
folder1/subfolder/file.txt라는 키로 폴더 구조 시뮬레이션
Delimiter: '/'로 CommonPrefixes를 활용하여 폴더처럼 보이게 함
빈 폴더 처리
실제 파일이 없는 빈 폴더는 .placeholder 더미 파일로 표현
실제 파일이 추가되면 .placeholder 삭제 가능
효율적인 API 설계
단일 파일: presigned URL 그대로 사용 (기존 방식 유지)
복수 파일/폴더: 서버에서 ZIP 생성 후 다운로드
업로드: presigned URL 방식 그대로 유지 (폴더는 경로만 유지)
📊 사용자 경험 개선
Before (현재)
파일들만 길게 나열
5개 파일 선택 → 5번 개별 다운로드
폴더 개념 없음
After (개선 후)
폴더/파일 계층 구조
5개 파일 선택 → 1개 ZIP 다운로드
폴더 단위 업로드/다운로드 가능
직관적인 네비게이션
🎯 구현 우선순위
다운로드 개선 → 사용자가 바로 체감할 수 있는 개선
폴더 표시 → 기존 파일들을 폴더 구조로 정리
폴더 생성 → 새로운 폴더 만들기
폴더 업로드 → 대량 파일 구조 유지 업로드
UI/UX 개선 → breadcrumb, 아이콘 등